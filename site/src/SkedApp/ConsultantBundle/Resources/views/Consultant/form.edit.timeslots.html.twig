<form action="{{ path('sked_app_consultant_update_timeslots',{'slug':consultant.slug,'slot':consultantTimeSlot.id}) }}" method="POST" {{ form_enctype(form) }}>
    <fieldset>
        <div class="control-group">
            <div class="control-label" for="first_name"><label>Day of the week: {{ consultantTimeSlot.daysOfTheWeek.name }} </label></div>
            <div class="controls">


            </div>
        </div>
        <div class="control-group">
            <div class="control-label" for="first_name"></div>
            <div class="controls">
                <table width="60%" id="slots">
                    <tbody>
              {% for slot in form.slots %}
                    <tr>
                        <td width="20%">{{ form_label(slot.startTimeslot) }}</td>
                        <td>{{ form_widget(slot.startTimeslot) }}</td>
                        <td width="20%">{{ form_label(slot.endTimeslot) }}</td>
                        <td>{{ form_widget(slot.endTimeslot) }}</td>
                        <td><a href="#" class="deleteTableRow">Delete</a></td>
                    </tr>
              {% endfor %}
                    </tbody>
                </table>    
                <span><a href="#" id="copyTableRow">Add a new slot</a></span>

            </div>
        </div>
        <div class="spacer"></div>    
      {{ form_widget(form.consultant) }}    
      {{ form_widget(form.daysOfTheWeek) }}    
        <div class="btn-toolbar">
            <div class="btn-group">
                <button type="submit" name="submit" class="btn btn-warning">Update <i class="icon-white icon-circle-arrow-right"></i></button>
            </div>
            <div class="btn-group">
                <a href="{{ path('sked_app_consultant_manage_timeslots',{'slug':consultant.slug}) }}.html" class="btn btn-small">Cancel</a>
            </div>
        </div>  
      {{ form_rest(form) }}
    </fieldset>
</form>
{{ tinymce_init() }}
<script type="text/javascript">

jQuery(document).ready(function() {
    
    //add a table row
    $('#copyTableRow').click(function(){
        var rowCount = $('#slots tr').length;
        
        if(0 == rowCount){
            alert('Please reload page');
            location.reload();
            return false;
        }
        
        var $tr = $('#slots').find("tbody tr:last").clone();
             // get the name attribute for the input and select fields
        $tr.find("input,select").attr("name", function()
        {
          
          var selectName = $(this).attr('name');
          
          if(0 < selectName.indexOf('[startTimeslot]')){
              selectName = 'consultant_time_slots[slots]['+rowCount+'][startTimeslot]';              
          }else{
              selectName = 'consultant_time_slots[slots]['+rowCount+'][endTimeslot]';     
          }    
          return selectName;
          
        });
        // append the new row to the table
        $('#slots').find("tbody tr:last").after($tr);
        
        $('.deleteTableRow').click(function(){
            var grandParent = $(this).parent().parent();
            grandParent.remove();      
            return false;
        });
        return false;
    });
     
    //remove table row
    $('.deleteTableRow').click(function(){
        var grandParent = $(this).parent().parent();
        var select = $(grandParent).find('select');
        var selectName = $(select).attr('id');

        var token_value = $('#consultant_time_slots_tokenDeletedSlot').val();
        if(token_value == ''){
           token_value = $('#'+selectName+' :selected').text() 
        }  
        
        $('#consultant_time_slots_tokenDeletedSlot').val(token_value);
       
        var jqxhr = $.get(Routing.generate('sked_app_consultant_ajax_delete_timeslot', { slot: {{consultantTimeSlot.id}}, startTime:token_value }), function(data) {
        })
        .done(function() { grandParent.remove(); alert("Slot removed successfully"); })
        .fail(function() { alert("Error occured while deleting slot,please consult admin"); })
        return false;
    });
        

});  
    
    </script>    